mongodb:
  annotations:
    operator.1password.io/item-path: vaults/Homelab/items/unifi-database-credentials
    operator.1password.io/item-name: unifi-database-credentials
  image:
    repository: docker.io/mongo
    tag: "7.0.2" # latest "supported" version by UniFi
    resources:
      limits:
        memory: 1024Mi
      requests:
        cpu: 100m
        memory: 128Mi
  livenessProbe:
    enabled: false
  readinessProbe:
    enabled: false
  persistence:
    storageClass: longhorn-backup
    size: 10Gi
    mountPath: /data/db
  extraEnvVarsSecret: unifi-database-credentials
  initdbScripts:
    unifi-init.sh: |
      #!/bin/bash
      mongo <<EOF
      db.getSiblingDB("${MONGO_DBNAME}").createUser({
          user: "${MONGO_USER}",
          pwd: "${MONGO_PASS}",
          roles: [{
              role: "dbOwner",
              db: "${MONGO_DBNAME}"
          }]
      });

      db.getSiblingDB("${MONGO_DBNAME}_stat").createUser({
          user: "${MONGO_USER}",
          pwd: "${MONGO_PASS}",
          roles: [{
              role: "dbOwner",
              db: "${MONGO_DBNAME}_stat"
          }]
      });
      EOF
